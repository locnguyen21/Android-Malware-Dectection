import glob
import pandas as pd
import os
from sklearn.utils import shuffle

#Combine multiple csv files to one csv files
#get data of 9 features and label into new pandas, save them in .csv file

def Concatenate(source_path):
    # path = 'C:\Android_Malware_Detection\Data\Train'

    all_files = glob.glob(source_path + "/*.csv")
    li = []
    for filename in all_files:
        print(filename)
        df = pd.read_csv(filename, index_col=None, header=0)
        li.append(df)

    #print(df.dtypes)
    print("Frame Combined")
    frame = pd.concat(li, axis=0, ignore_index=True, sort=False)
    a = list(frame)
    #frame = shuffle(frame)
    #pd.DataFrame(frame).to_csv(to_path, header = a, index=None)
    return frame,a

def Concentrate_Clean(source_path,to_path,label):
    frame, a = Concatenate(source_path)

    header = []

    #print(header)
    #frame_concen = frame.drop(columns=[' Fwd Header Length.1'])
    print(len(list(frame)))
    frame_concen = frame
    #pd.DataFrame(frame).to_csv(to_path,header = a, index = None)
    print(frame_concen)
    print(frame_concen.isnull().sum())
    print(frame_concen.shape)
    frame_clean = frame_concen.dropna()
    print(frame_clean.isnull().sum())
    print(frame_clean.shape)

    a = list(frame_clean)

    for i in a:
        i = i.lstrip()
        header.append(i)

    #frame_clean = frame_clean.values
    # for i in frame_clean:
    #     if (label == "malware"):
    #         i[83] = 0
    #     elif (label == "benign"):
    #         i[83] = 1

    pd.DataFrame(frame_clean).to_csv(to_path, header=header, index=None)
    return frame_clean
source_path = "C:\Android_Malware_Detection\pcap"
#C:\Android_Malware_Detection\Data\Raw_Data\Benign-CSVs\Benign\Benign2017
#source_path = "C:\Android_Malware_Detection\Data\Raw_Data\Benign-CSVs\Benign\Benign2017"
to_path = 'Data\Adware.csv'
#to_path = "C:\Android_Malware_Detection\Data\Raw_Data\Testing-data\Benign2017.csv"
a = "malware"
b = "benign"
c = "concen"
Concentrate_Clean(source_path,to_path,c)

def Concentrate_Feature(source_path,to_path,label):
    frame_clean = Concentrate_Clean(source_path,to_path,label)
    print(list(frame_clean))
    last_frame = frame_clean[['Total Length of Bwd Packets', 'Fwd Packet Length Std',
                          'Bwd Packet Length Min', 'Bwd Packet Length Std',
                          'Flow IAT Max', 'Fwd IAT Min', 'Init_Win_bytes_forward',
                          'Init_Win_bytes_backward', 'min_seg_size_forward', 'Label']]
    header = list(last_frame)
    pd.DataFrame(last_frame).to_csv(to_path, header= header, index=None)
